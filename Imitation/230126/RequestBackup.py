import usb.core
import usb.util
import os
import usb.backend.libusb1

#Func
def send(command, ep_out, ep_in):
	dev.write(ep_out, command)
	try:
		res = dev.read(ep_in, 100000, 1000)
		print(res)
	except:
		pass

#main
backend = usb.backend.libusb1.get_backend()
print("[*]Configuration")
dev = usb.core.find(idVendor=0x04E8, idProduct=0x6860, backend=backend)
cfg = dev.get_active_configuration()
intf = cfg[(0, 0)]
ep_out = intf[1]
ep_in = intf[0]
print("[*]mtp-connection")
os.system('mtp-connect')

print("[*]Start communication")
print("[*]Init")
send(bytearray.fromhex("10000000010003957e8a000002000000"), ep_out, ep_in)
send(bytearray.fromhex("1c010000020003957e8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"), ep_out, ep_in)
print("[*]Configuration")
send(bytearray.fromhex("0c000000010001958d000000"), ep_out, ep_in)
send(bytearray.fromhex("a7000000020001958d000000734c3666734f643070506c6d3859463466374d6a7768762f6e2f6a44666e6e397353777a677674333559662f496d70354b724a534b43325664523442465633724d7a3348596376520a5957364146386b7665366935635344464d48536145506e567072724530324f5256774730312b73704367322b58353764374d4244436a6e2f4c6352524b7266666951446b626b316d0a667361764e773d3d0a"), ep_out, ep_in)
print("[*]Request to create Backup File")
send(bytearray.fromhex("0c00000001000195e7000000"), ep_out, ep_in)
send(bytearray.fromhex("e700000002000195e7000000734c3666734f643070506c6d3859463466374d6a776735474d734d627267696a776476382b76714d64652b647955334f52554274476c4b766239535964455436664a715a394742780a744d6536506337356c72454253736746477a6f4d4a6e6b69424a4f346c6c2b584f796146452f554c72666530573649394242413367357631326a316f6b4b534a6938496e4577554f0a5a4836766735615a6c536455516e365a79423853553156642b33704e5853514b43703059424d524835754c6a736b316853316449534d7373386b6e545339454f34554e7976413d3d0a"), ep_out, ep_in)
print("[*]Request to Specific Backup Items")
#
print("[*]Done")